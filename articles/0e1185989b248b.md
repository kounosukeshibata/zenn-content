---
title: "Spring Bootã¨Reactã®é€£æºã‚’å­¦ã¶ãŸã‚ã«ToDoã‚¢ãƒ—ãƒªã‚’ä½œã‚‹"
emoji: "ğŸ“˜"
type: "tech"
topics:
  - "docker"
  - "react"
  - "typescript"
  - "springboot"
  - "ã‚³ãƒ³ãƒ†ãƒŠ"
published: true
published_at: "2025-01-07 22:18"
---

# ã¯ã˜ã‚ã«

æ™®æ®µã¯ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚’ Java ã§å®Ÿè£…ã—ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ Spring Boot ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŒã€å€‹äººé–‹ç™ºã®ãŸã‚ã« React ã‚’å­¦ç¿’ã—ãŸãŸã‚ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ã©ã®ã‚ˆã†ã«é€£æºã•ã›ã‚‹ã®ã‹çŸ¥ã‚ŠãŸã„ã¨æ€ã„èª¿ã¹ãªãŒã‚‰å®Ÿè£…ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ãŸã€‚

ä»¥ä¸‹ã®è¨˜äº‹ã‚’è¦‹ã¤ã‘ãŸã®ã§ã€å…ˆæ—¥å­¦ç¿’ã—ãŸã¦ã® Docker ã‚’ä½¿ã£ã¦ Spring Boot Ã— React(TypeScript)ã§é€£æºã§ãã‚‹çŠ¶æ…‹ã‚’ç›®æŒ‡ã—ã¦å®Ÿè£…ã—ã¦ã¿ã‚‹ã€‚
https://qiita.com/studio_meowtoon/items/7d4d0bf73e04e01be558

ä»Šå›ã¯ Java ã‚„ TypeScript ã®ã‚³ãƒ¼ãƒ‰ã‚’ç´°ã‹ãèª¬æ˜ã™ã‚‹ã®ã§ã¯ãªãã€Docker ç’°å¢ƒä¸Šã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’èµ·å‹•ã—ãŸã‚Šã€åˆ¥ã‚³ãƒ³ãƒ†ãƒŠã§èµ·å‹•ã—ãŸ API ã¨å…ˆã»ã©ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é€£æºã•ã›ãŸã‚Šã€SpringBoot ã¨ React ã‚’é€£æºã•ã›ãŸã‚Šã€Docker ã‚³ãƒ³ãƒ†ãƒŠé–“ã®é€šä¿¡é€£æºã¨ã„ã†éƒ¨åˆ†ã‚’ä¸­å¿ƒã«å­¦ç¿’ã—ã¦ã„ããŸã„ã€‚

# é–‹ç™ºç’°å¢ƒ

- OS
  - macOS Sonoma ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 14.5
- IDE
  - VSCode
- è¨€èª
  - Javaï¼ˆSpring Bootï¼‰
  - TypeScriptï¼ˆReactï¼‰
- DB
  - MySQL
- ç’°å¢ƒæ§‹ç¯‰
  - Docker

# å®Ÿç¾ã™ã‚‹ã“ã¨

å‰è¿°ã®@studio_meowtoon ã•ã‚“ã®è¨˜äº‹ã¨åŸºæœ¬çš„ã«åŒã˜ã§ã™ã€‚
å­¦ç¿’ã®ãŸã‚ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§å†ç¾ã™ã‚‹ã“ã¨ãŒç›®çš„ãªã®ã§è¨˜äº‹é€šã‚Šã®æ‰‹é †ã§é€²ã‚ã¾ã™ãŒã€è‡ªåˆ†ã®å®Ÿè¡Œç’°å¢ƒã§ã†ã¾ãã„ã‹ãªã‹ã£ãŸã“ã¨ã‚„ç–‘å•ãŒç”Ÿã˜ãŸã¨ã“ã‚ã¯é©å®œè‡ªåŠ›ã§èª¿ã¹ã¦è§£æ±ºã—ã¾ã—ãŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/20645429684a-20241229.png)

# ãƒ„ãƒ¼ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯

npm

```
$ node -v
v20.18.0
```

```
$ npm -v
10.9.0
```

Docker

```
$ docker --version
Docker version 27.4.1, build b9d17eaebb
```

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†(Git)ã«ã¤ã„ã¦

ä»¥å‰è‡ªåˆ†ã§æ›¸ã„ãŸ Git ã®å‚™å¿˜éŒ²ã‚’è¦‹è¿”ã—ã¦æ–°ã—ããƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚
https://zenn.dev/yadonn/articles/ea3356426caccf

## é–‹ç™ºç”¨ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆ

1. ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªä½œæˆã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã¸ã®åˆå›ã‚³ãƒŸãƒƒãƒˆ
   é–‹ç™ºç”¨ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã¨ã—ã¦ personalDevelopment ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã®ä¸­ã«ä»Šå›ã®å¯¾è±¡ã§ã‚ã‚‹ todoApp_test ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚
   todoApp_test ãƒ•ã‚©ãƒ«ãƒ€é…ä¸‹ã§`git init`ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å®Ÿè¡Œã—ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã€‚
   ã¨ã‚Šã‚ãˆãš README ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ä½œæˆã—ã¦ã‚¹ãƒ†ãƒ¼ã‚¸ã«`git add`ã—ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã«`git commit`ã™ã‚‹ã€‚
   â€»[ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ä½œæˆæ–¹æ³•](https://www.wantedly.com/companies/makeshop/post_articles/920329)
2. GitHub ä¸Šã§ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’æ–°è¦ä½œæˆ
   GitHub ã®ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ your profile ã®ãƒªãƒã‚¸ãƒˆãƒªã‚¿ãƒ–ã‹ã‚‰ã€todoApp_test ã®åå‰ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’æ–°è¦ä½œæˆã€‚
3. ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã«ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚’æ–°è¦è¿½åŠ ã™ã‚‹

```
git remote add origin https://github.com/kounosukeshibata/todoApp_test.git
```

ä¸Šè¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šã€æ¬¡å›ã‹ã‚‰ origin æŒ‡å®šã§ git push ã§ãã‚‹ã€‚ 4. ãƒ­ãƒ¼ã‚«ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«é€ä¿¡

```
git push origin master
```

# ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰

RDBMS ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ ToDo ã‚¢ãƒ—ãƒªç”¨ã® REST API ã‚µãƒ¼ãƒ“ã‚¹ã‚’ Docker ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦ãã‚Œãã‚Œèµ·å‹•ã™ã‚‹æ‰‹é †ã‚’è¨˜ã™ã€‚
ã¾ãŸã€ä»Šå›ã¯ Dockerfile ä½œæˆã®æ‰‹é †ã‚’é€šã˜ã¦ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã‚’è¡Œã†ã€‚

## MySQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®èµ·å‹•

### Docker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½œæˆã™ã‚‹

```
$ docker network create net-todo
```

Docker å†…ã§ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚ã®ãƒ¦ãƒ¼ã‚¶å®šç¾©ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆnet-todo ã¨åä»˜ã‘ã‚‹ï¼‰ã‚’ä½œæˆã™ã‚‹ã€‚

### Docker ç’°å¢ƒã§ MySQL ã‚’ä½¿ç”¨ã™ã‚‹æ‰‹é †

1.  Dockerfile ã‚’ä½œæˆã™ã‚‹æ‰‹é † - MySQL ã‚³ãƒ³ãƒ†ãƒŠå®Ÿè¡Œç”¨ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆãƒ»ç§»å‹•ã™ã‚‹
    `      mkdir -p ~/todoApp_test/tmp/mysql-base
      cd ~/todoApp_test/tmp/mysql-base
     ` - SQL ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    `      vim init_db.sql
     ` - SQL ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹
    ```sql:init_db
    DROP DATABASE IF EXISTS db_todo;
    CREATE DATABASE db_todo;
            -- CREATE TABLEã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æŒ‡å®š
            CREATE TABLE db_todo.todos (
            id INT AUTO_INCREMENT PRIMARY KEY,
            content TEXT NOT NULL,
            created_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            completed_date TIMESTAMP
            );

            INSERT INTO db_todo.todos (content, completed_date)
            VALUES
            ('é£Ÿæã‚’è²·ã†', NOW()),
            ('å ±å‘Šæ›¸ã‚’ä»•ä¸Šã’ã‚‹', NOW()),
            ('é‹å‹•ã™ã‚‹', NOW()),
            ('æœ¬ã‚’èª­ã‚€', NULL),
            ('è«‹æ±‚æ›¸ã‚’æ”¯æ‰•ã†', NULL),
            ('å®¶ã‚’æƒé™¤ã™ã‚‹', NULL),
            ('ãƒ—ãƒ¬ã‚¼ãƒ³ã®æº–å‚™ã™ã‚‹', NULL),
            ('ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã', NULL);
          ```
        - Dockerãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
          ```
          vim Dockerfile
          ```
        - Dockerãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹
          ```Dockerfile
            # set up the container.
            FROM mysql:8.0

            # set utf-8 encoding and mysql root password.
            ENV LANG=ja_JP.UTF-8
            ENV MYSQL_ROOT_PASSWORD=password

            # copy the init sql file to the init dir.
            COPY init_db.sql /docker-entrypoint-initdb.d/
          ```
        -  ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹
          ```
          docker build --no-cache --tag mysql-base:latest .
          ```
        -  ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèªã™ã‚‹
          ```
          docker images | grep mysql-base
          ```
        -  ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’èµ·å‹•ã™ã‚‹
          ```
          docker run -d --publish 3306:3306 --name mysql-todo --net net-todo --volume db_todo_mysql:/var/lib/mysql mysql-base
          ```
    :::message
    ä¸Šè¨˜ã§ä½œæˆã—ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’åœæ­¢&å‰Šé™¤ã•ã›ã‚‹å ´åˆ

```
docker stop mysql-todo
docker rm mysql-todo
```

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤ã™ã‚‹å ´åˆ

```
docker rmi mysql-base
```

:::

:::message
ã“ã“ã¾ã§ã®æ‰‹é †ã§ä»¥ä¸‹ã‚’å®Ÿæ–½ã€‚

- MySQL ã®ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ
- DB ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆ
- ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥
  :::

### GUI ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ç¢ºèª

https://www.mysql.com/jp/products/workbench/
ä¸Šè¨˜ã®å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ MySQL Workbench ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚
MySQL ã‚’ GUI ã‹ã‚‰æ“ä½œã™ã‚‹çµ±åˆãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ã€‚
ã“ã®ãƒ„ãƒ¼ãƒ«ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§æ‰‹è»½ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã§ãã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/7b2b24587e95-20250104.png)
![](https://storage.googleapis.com/zenn-user-upload/82609b5d553a-20250104.png)

MySQL Workbench ã§ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ãŸãŒã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒã‚ã‹ã‚‰ãšã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã®ä¸­èº«ã‚’ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ããªã‹ã£ãŸãŒã€MySQL ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã“ã¨ã§ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚µã‚¯ã‚»ã‚¹ã§ããŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/9668fb64a443-20250104.png)

ã¾ãŸã€MySQL Workbench ä¸Šã§`SELECT * FROM db_todo.todos;`ã‚’å®Ÿè¡Œã—ã¦ã‚‚ã€Docker ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§èµ·å‹•ã—ãŸ MySQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ããªã‹ã£ãŸã€‚
ç†ç”±ã¯ã€MySQL Workbench ä¸Šã«ã‚¹ã‚­ãƒ¼ãƒã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒã†ã¾ãã§ãã¦ã„ãªã‹ã£ãŸãŸã‚ãªã®ã§ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã®è©²å½“ç®‡æ‰€ã‚’å‚è€ƒã«é€²ã‚ãŸã¨ã“ã‚ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã«æˆåŠŸã—ãŸã€‚
https://qiita.com/tamamu79/items/c045524f46060ef43f34#mysql-workbench%E3%81%A7sql%E3%82%92import%E3%81%99%E3%82%8B
![](https://storage.googleapis.com/zenn-user-upload/182c3505a75a-20250106.png)

## REST API ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’èµ·å‹•

### REST API ã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…æ‰‹é †

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
   ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã™ã‚‹ã€‚

```linux
mkdir ~/todoApp_test/tmp/restapi-spring-boot
cd ~/todoApp_test/tmp/restapi-spring-boot
```

2. Model ã‚¯ãƒ©ã‚¹ã®ä½œæˆ
   restapi-spring-boot ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ãŸçŠ¶æ…‹ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

```linux
mkdir -p src/main/java/com/example/springboot/model
vim src/main/java/com/example/springboot/model/Todo.java
```

Todo ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚

```java:Todo.java
package com.example.springboot.model;

import java.util.Date;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Table;
import javax.persistence.Temporal;
import javax.persistence.TemporalType;
import javax.persistence.Transient;

import lombok.Data;
import com.fasterxml.jackson.annotation.JsonIgnore;
import com.fasterxml.jackson.annotation.JsonProperty;

// ToDo ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’è¡¨ã™ã‚¯ãƒ©ã‚¹
@Data
@Entity @Table(name="todos")
public class Todo {
    // RDBMS æœ¬æ¥ã® int å‹ã®ã‚­ãƒ¼ï¼šAPI å…¥å‡ºåŠ›ã® JSON ã«ã¯ãƒãƒƒãƒ”ãƒ³ã‚°ã—ãªã„
    @JsonIgnore
    @GeneratedValue(strategy=GenerationType.IDENTITY)
    @Id @Column(name="id", unique=true) Long _rdbms_id;

    // string å‹ã® ID ã‚’å®šç¾©ï¼šRDBMS å´ã«ã¯ãƒãƒƒãƒ”ãƒ³ã‚°ã—ãªã„
    @Transient String id;
    public String getId() { return Long.toString(_rdbms_id); }
    public void setId(String id) { _rdbms_id = Long.parseLong(id); }

    @JsonProperty("content")
    @Column(name="content") String content;

    @JsonProperty("created_date")
    @Column(name="created_date")
    @Temporal(TemporalType.TIMESTAMP) Date createdDate;

    @JsonProperty("completed_date")
    @Column(name="completed_date")
    @Temporal(TemporalType.TIMESTAMP) Date completedDate;
}
```

TodoRepository ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚

```linux
mkdir -p src/main/java/com/example/springboot/model
vim src/main/java/com/example/springboot/model/TodoRepository.java
```

```java:TodoRepository.java
package com.example.springboot.model;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;

// ToDo ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾ã™ã‚‹ Repository ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹
public interface TodoRepository extends JpaRepository<Todo, Long> {
    List<Todo> findByCompletedDateIsNotNull();
}
```

4. Applicationã€Controller ã‚¯ãƒ©ã‚¹ã®ä½œæˆ
   Application ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚

```linux
vim src/main/java/com/example/springboot/Application.java
```

```java:Application.java
package com.example.springboot;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.autoconfigure.domain.EntityScan;
import org.springframework.data.jpa.repository.config.EnableJpaRepositories;
import org.springframework.scheduling.annotation.EnableAsync;

@EntityScan("com.example.springboot.*")
@EnableJpaRepositories("com.example.springboot.*")
@SpringBootApplication
@EnableAsync
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

TodoController ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚

```linux
vim src/main/java/com/example/springboot/TodoController.java
```

```java:TodoController.java
package com.example.springboot;

import java.util.Date;
import java.util.List;
import java.util.Optional;
import java.util.concurrent.CompletableFuture;

import org.springframework.scheduling.annotation.Async;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RestController;

import com.example.springboot.model.Todo;
import com.example.springboot.model.TodoRepository;

@CrossOrigin( // CORS è¨­å®šï¼šé©åˆ‡ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚
    origins = "*",
    methods = { RequestMethod.GET, RequestMethod.POST, RequestMethod.PUT, RequestMethod.DELETE }
)
@RestController
@RequestMapping("/todos")
public class TodoController {

    private final TodoRepository _todoRepository;

    public TodoController(TodoRepository todoRepository) {
        _todoRepository = todoRepository;
    }

    // ã™ã¹ã¦ã® ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã—ã¾ã™ã€‚
    @GetMapping
    @Async public CompletableFuture<List<Todo>> getAllTodos() {
        List<Todo> todos = _todoRepository.findAll();
        return CompletableFuture.completedFuture(todos);
    }

    // å®Œäº†ã—ãŸ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã—ã¾ã™ã€‚
    @GetMapping("/complete")
    @Async public CompletableFuture<List<Todo>> getCompleteTodos() {
        List<Todo> todos = _todoRepository.findByCompletedDateIsNotNull();
        return CompletableFuture.completedFuture(todos);
    }

    // ID ã§ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã—ã¾ã™ã€‚
    @GetMapping("/{id}")
    @Async public CompletableFuture<Optional<Todo>> getTodo(@PathVariable String id) {
        Optional<Todo> todo = _todoRepository.findById(Long.parseLong(id));
        return CompletableFuture.completedFuture(todo);
    }

    // æ–°ã—ã„ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¾ã™ã€‚
    @PostMapping
    @Async public CompletableFuture<Todo> createTodo(@RequestBody Todo todo) {
        todo.setCreatedDate(new Date());
        return CompletableFuture.completedFuture(_todoRepository.save(todo));
    }

    // æ—¢å­˜ã® ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°ã—ã¾ã™ã€‚
    @PutMapping("/{id}")
    @Async public CompletableFuture<Todo> updateTodo(@PathVariable String id, @RequestBody Todo todo) {
        Optional<Todo> exist = _todoRepository.findById(Long.parseLong(id));
        if (exist.isPresent()) {
            Todo target = exist.get();
            target.setContent(todo.getContent());
            target.setCompletedDate(todo.getCompletedDate());
            return CompletableFuture.completedFuture(_todoRepository.save(target));
        }
        return CompletableFuture.completedFuture(null);
    }

    // ID ã§ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤ã—ã¾ã™ã€‚
    @DeleteMapping("/{id}")
    @Async public CompletableFuture<Void> deleteTodo(@PathVariable String id) {
        _todoRepository.deleteById(Long.parseLong(id));
        return CompletableFuture.completedFuture(null);
    }
}
```

6. Spring Boot ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
   application.properties ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```linux
mkdir -p src/main/resources
vim src/main/resources/application.properties
```

```properties:application.properties
spring.datasource.url=jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=${DB_USER}
spring.datasource.password=${DB_PASSWORD}
spring.jpa.show-sql=false
```

- application.properties ã®ã‚³ãƒ¼ãƒ‰å†…å®¹ã®èª¬æ˜
  - spring.datasource.url
    DB æ¥ç¶šã® URL ã‚’æŒ‡å®šã™ã‚‹ã€‚
    ${}ã¨ã„ã†æ›¸ãæ–¹ã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã¨ã„ã„ã€ã“ã‚Œã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§å®Ÿéš›ã®å€¤ãŒç’°å¢ƒå¤‰æ•°ã‚ˆã‚Šå–å¾—ã•ã‚Œã‚‹ã€‚å®Ÿè¡Œè€…ã¯ã€å®Ÿè¡Œæ™‚ã«ç’°å¢ƒå¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
  - spring.datasource.username
    DB æ¥ç¶šã«ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’æŒ‡å®šã™ã‚‹ã€‚
  - spring.datasource.password
    DB æ¥ç¶šã«ä½¿ç”¨ã™ã‚‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æŒ‡å®šã™ã‚‹ã€‚
  - spring.jpa.show-sql
    JPA ã«ã‚ˆã‚‹ã‚¯ã‚¨ãƒªã®ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã©ã†ã‹ã‚’æŒ‡å®šã™ã‚‹ã€‚ã“ã“ã§ã¯ false ã«è¨­å®šã•ã‚Œã¦ãŠã‚Šã€ã‚¯ã‚¨ãƒªã®ãƒ­ã‚°ã¯è¡¨ç¤ºã•ã‚Œãªã„ï¼ˆè‡ªåˆ†ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ä¸è¦ãªè¡Œã¨ã—ã¦å‰Šé™¤ï¼‰

7. pom.xml ã®ä½œæˆ
   pom.xml ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```linux
vim pom.xml
```

```xml:pom.xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.15</version>
        <relativePath /> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.example</groupId>
    <artifactId>restapi-spring-boot</artifactId>
    <version>1.0</version>
    <name>restapi-spring-boot</name>
    <properties>
        <java.version>17</java.version>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        <dependency>
            <groupId>javax.persistence</groupId>
            <artifactId>javax.persistence-api</artifactId>
            <version>2.2</version>
        </dependency>
        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.33</version>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <version>1.18.22</version>
            <scope>provided</scope>
        </dependency>
    </dependencies>
    <build>
        <finalName>app</finalName>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>
</project>
```

- pom.xml ã®ã‚³ãƒ¼ãƒ‰å†…å®¹ã®èª¬æ˜
  - modelVersion
    Maven ãƒ¢ãƒ‡ãƒ«ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã€‚é€šå¸¸ã¯ 4.0.0 ã‚’æŒ‡å®šã€‚
  - parent
    æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦ªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡å®šã€‚
    spring-boot-starter-parent ã¯ã€Spring Boot ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦ªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ã‚„ãƒ“ãƒ«ãƒ‰è¨­å®šãŒäº‹å‰ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚
  - groupId, artifactId, version, name
    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® Maven ã®ã‚°ãƒ«ãƒ¼ãƒ— IDã€ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ IDã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’æŒ‡å®šã€‚
  - properties
    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æŒ‡å®šã€‚
    ä¾‹ãˆã°ã€java ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãªã©ã€‚
  - dependencies
    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä¾å­˜ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æŒ‡å®šã€‚
  - build
    ãƒ“ãƒ«ãƒ‰ã«é–¢ã™ã‚‹è¨­å®šã‚’æŒ‡å®šã€‚
    ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒŠãƒ«åã‚„ã€ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šãŒå«ã¾ã‚Œã¦ã„ã‚‹ã€‚

8. ã‚¢ãƒ—ãƒªã®èµ·å‹•
   ã“ã®å¾Œ Docker ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§èµ·å‹•ã™ã‚‹ãŒã€ã“ã“ã§ã¯å®Ÿè£…å¾Œã®ãƒ†ã‚¹ãƒˆèµ·å‹•ã‚’è¡Œã†ã€‚

å…ˆã»ã©èµ·å‹•ã—ãŸ MySQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®æƒ…å ±ã«é–¢ã—ã¦ã€ç’°å¢ƒå¤‰æ•°ã‚’ä½œæˆã—ã¦ export ã—ã‚ˆã†ã¨ã—ãŸãŒä½•æ•…ã‹ã†ã¾ãã„ã‹ãªã‹ã£ãŸã€‚
ä»£æ›¿ã¨ã—ã¦ã€ä»¥ä¸‹ã«è©²å½“ã™ã‚‹å€¤ã‚’ application.properties ã«ç›´æ¥æ›¸ãè¾¼ã‚“ã§ä¿å­˜ã—ãŸã€‚
DB_HOST=127.0.0.1
DB_PORT=3306
DB_NAME=db_todo
DB_USER=root
DB_PASSWORD=****\*****

ä¸Šè¨˜ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ã‚’ä¿å­˜å¾Œã€Spring Boot ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã€‚

```linux
mvn spring-boot:run -Dspring-boot.run.arguments="--server.port=5000"
```

:::message
ãƒãƒ¼ãƒˆç•ªå· 5000 ã‚’æŒ‡å®šã—ã¦ã„ã‚‹ãŒã€ä»–ã®ç•ªå·ã§ã‚‚è‰¯ã„ã€‚
:::
:::message
ã‚¢ãƒ—ãƒªã‚’åœæ­¢ã™ã‚‹ã¨ãã¯ Ctrl + C ã‚’æŠ¼ã™ã€‚
:::

ã“ã“ã§ã€mvn ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã¨ã“ã‚`mvn: command not found`ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã€‚
mvn ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆãªã„çŠ¶æ³ã ã£ãŸãŸã‚ã€Apache Maven ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã“ã‚ã‹ã‚‰å†åº¦ã‚„ã‚Šç›´ã™ã“ã¨ã«ã—ãŸã€‚
https://sukkiri.jp/technologies/devtools/maven/apache-maven-installmacos.html
ç„¡äº‹ã‚¢ãƒ—ãƒªã®èµ·å‹•ã«æˆåŠŸã€‚
![](https://storage.googleapis.com/zenn-user-upload/250dca9601ba-20250106.png)

ä»¥ä¸‹ã«å‹•ä½œç¢ºèªã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ãŒã€ä¸€æ—¦ã“ã“ã¾ã§ã§æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ã† REST API ã‚¢ãƒ—ãƒªã®å®Ÿè£…ãŒå®Œäº†ã€‚

### ã‚¢ãƒ—ãƒªã®å‹•ä½œç¢ºèªï¼ˆãƒ†ã‚¹ãƒˆï¼‰

åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã€curl ã‚³ãƒãƒ³ãƒ‰ã§å„ã‚±ãƒ¼ã‚¹ã‚’ç¢ºèªã™ã‚‹ã€‚

1. GET: /todos ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œç¢ºèª
   å…¨ã¦ã® ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã™ã‚‹ã€‚

```
curl -s http://localhost:5000/todos | jq '.'
```

```
[
  {
    "id": "1",
    "content": "é£Ÿæã‚’è²·ã†",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": "2025-01-06T12:23:08.000+00:00"
  },
  {
    "id": "2",
    "content": "å ±å‘Šæ›¸ã‚’ä»•ä¸Šã’ã‚‹",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": "2025-01-06T12:23:08.000+00:00"
  },
  {
    "id": "3",
    "content": "é‹å‹•ã™ã‚‹",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": "2025-01-06T12:23:08.000+00:00"
  },
  {
    "id": "4",
    "content": "æœ¬ã‚’èª­ã‚€",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": null
  },
  {
    "id": "5",
    "content": "è«‹æ±‚æ›¸ã‚’æ”¯æ‰•ã†",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": null
  },
  {
    "id": "6",
    "content": "å®¶ã‚’æƒé™¤ã™ã‚‹",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": null
  },
  {
    "id": "7",
    "content": "ãƒ—ãƒ¬ã‚¼ãƒ³ã®æº–å‚™ã™ã‚‹",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": null
  },
  {
    "id": "8",
    "content": "ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": null
  }
]
```

2. GET: /todos/complete ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œç¢ºèª
   å®Œäº†ã—ãŸ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã™ã‚‹ã€‚

```
curl -s http://localhost:5000/todos/complete | jq '.'
```

```
[
  {
    "id": "1",
    "content": "é£Ÿæã‚’è²·ã†",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": "2025-01-06T12:23:08.000+00:00"
  },
  {
    "id": "2",
    "content": "å ±å‘Šæ›¸ã‚’ä»•ä¸Šã’ã‚‹",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": "2025-01-06T12:23:08.000+00:00"
  },
  {
    "id": "3",
    "content": "é‹å‹•ã™ã‚‹",
    "created_date": "2025-01-06T12:23:08.000+00:00",
    "completed_date": "2025-01-06T12:23:08.000+00:00"
  }
]
```

3. GET: /todos/{id} ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œç¢ºèª
   ID ã§ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã™ã‚‹ã€‚

```
curl -s http://localhost:5000/todos/8 | jq '.'
```

```
{
  "id": "8",
  "content": "ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã",
  "created_date": "2025-01-06T12:23:08.000+00:00",
  "completed_date": null
}
```

5. POST: /todos ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œç¢ºèª
   æ–°ã—ã„ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã™ã‚‹ã€‚

```
curl -s -X POST http://localhost:5000/todos \
    -H 'Content-Type: application/json; charset=utf-8' \
    -d \
'{
    "content": "æ˜¼å¯ã‚’ã™ã‚‹"
}' | jq '.'
```

```
{
  "id": "9",
  "content": "æ˜¼å¯ã‚’ã™ã‚‹",
  "created_date": "2025-01-06T14:17:25.490+00:00",
  "completed_date": null
}
```

7. PUT: /todos/{id} ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œç¢ºèª
   æ—¢å­˜ã® ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°ã™ã‚‹ã€‚

```
curl -s -X PUT http://localhost:5000/todos/9 \
    -H 'Content-Type: application/json; charset=utf-8' \
    -d \
'{
    "content": "çª“ã‚’é–‹ã‘ã‚‹"
}' | jq '.'
```

```
{
  "id": "9",
  "content": "çª“ã‚’é–‹ã‘ã‚‹",
  "created_date": "2025-01-06T14:17:25.000+00:00",
  "completed_date": null
}
```

9. DELETE: /todos/{id} ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œç¢ºèª
   ID ã§ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤ã™ã‚‹ã€‚

```
curl -s -X DELETE http://localhost:5000/todos/9 | jq '.'
```

```
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãªã—
```

### Docker ã§ REST API ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã™ã‚‹æ‰‹é †

å…ˆã»ã© REST API ã‚µãƒ¼ãƒ“ã‚¹ã‚’ Maven ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ãƒ†ã‚¹ãƒˆèµ·å‹•ã—ãŸãŒã€ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ Docker ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§èµ·å‹•ã•ã›ã‚‹ãŸã‚ä»¥ä¸‹ã®æ‰‹é †ã§èµ·å‹•ã‚’å®Ÿæ–½ã™ã‚‹ã€‚

1. ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ
   restapi-spring-boot ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã§ Dockerfile ã‚’ä½œæˆã€‚

```linux
vim Dockerfile
```

```linux:Dockerfile
# build the app.
FROM openjdk:17-jdk-slim as build-env

# set the working dir.
WORKDIR /app

# install build tools and libraries.
RUN apt-get update && apt-get install -y maven

# copy source code to the working dir.
COPY . .

# build the app.
RUN mvn clean package

# set up the container.
FROM debian:12-slim

# set the working dir.
WORKDIR /app

# install the openjdk-17-jre-headless and clean up unnecessary files.
RUN apt-get update && \
    apt-get install -y --no-install-recommends openjdk-17-jre-headless && \
    apt-get autoremove -y && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# set environment variables.
ENV JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64/jre
ENV PATH=$PATH:$JAVA_HOME/bin

# copy the built app from the build-env.
COPY --from=build-env /app/target/*.jar app.jar

# expose the port.
EXPOSE 8080

# command to run the app using java.
ENTRYPOINT ["java","-jar","app.jar"]
```

Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’èµ·å‹•ã™ã‚‹ã€‚

```
sudo service docker start
```

- Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³
  docker ã‚³ãƒãƒ³ãƒ‰ã¯ã€ã‚³ãƒãƒ³ãƒ‰è‡ªä½“ï¼ˆclientï¼‰ã¨ãã‚Œã‚’å—ã‘å–ã‚‹ Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³(server)ã¨ã„ã†æ§‹æˆã«ãªã£ã¦ã„ã¦ã€run ã‚„ build ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘å–ã£ãŸ Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒå®Ÿéš›ã®å‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã‚³ãƒ³ãƒ†ãƒŠç­‰ã® Docker ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆãƒ»ç®¡ç†ã‚’è¡Œã†ã€‚
  https://docs.docker.jp/v1.10/engine/understanding-docker.html#id7
- Docker Engine ã¨ã®é•ã„
  https://docs.docker.jp/v1.10/machine/overview.html#docker-engine-docker-machine
  Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒå‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ãƒ‡ãƒ¼ãƒ¢ãƒ³ã¯ç‰¹å®šã® REST API ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã‚³ãƒãƒ³ãƒ‰ãƒ»ãƒ©ã‚¤ãƒ³ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆCLIï¼‰ã§ãƒ‡ãƒ¼ãƒ¢ãƒ³ã¨é€šä¿¡ã™ã‚‹ã€‚ä¸€æ–¹ã§ã€Docker ã‚¨ãƒ³ã‚¸ãƒ³ã¯ CLI ã‹ã‚‰ã® docker ã‚³ãƒãƒ³ãƒ‰ã‚’å—ã‘ä»˜ã‘ã‚‹ã€‚
- Docker Machine ã¨ã¯
  ä»®æƒ³ãƒã‚·ãƒ³ä¸Šã« Docker Engine ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã®ã“ã¨ã€‚

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚

```
docker build --no-cache --tag api-todo-spring-boot:latest .
```

2. ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’èµ·å‹•
   ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã€‚ï¼ˆâ€»ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢ã¯ Ctrl + C ã‚’æŠ¼ä¸‹ã™ã‚‹ï¼‰
   :::message alert
   MySQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã«ä½œæˆã—ãŸ net-todo ã¨ã„ã† Docker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç”¨ã„ã¦ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã‚’è¡Œã†ãŸã‚æ³¨æ„ã€‚
   :::

```
docker run --rm --publish 5000:8080 --name api-local --net net-todo --env DB_HOST=mysql-todo --env DB_PORT=3306 --env DB_NAME=db_todo --env DB_USER=root --env DB_PASSWORD=password api-todo-spring-boot
```

:::message
ä¸Šè¨˜ã§ä½œæˆã—ãŸã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã‚’åœæ­¢&å‰Šé™¤ã•ã›ã‚‹å ´åˆ

```
docker stop api-local
docker rm api-local
```

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å‰Šé™¤ã™ã‚‹å ´åˆ

```
docker rmi api-todo-spring-boot
```

:::

:::message
ã“ã“ã¾ã§ã®æ‰‹é †ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã® Docker ã§ REST API ã‚¢ãƒ—ãƒªã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ããŸã€‚
:::

3. ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã®å‹•ä½œç¢ºèª
   åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ curl ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã€‚
   ID ã§ ToDo ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã™ã‚‹ã€‚

```linux
curl -s http://localhost:5000/todos/8 | jq '.'
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
{
  "id": "8",
  "content": "ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã",
  "created_date": "2025-01-03T18:47:22.000+00:00",
  "completed_date": null
}
```

ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚

```
docker ps
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
CONTAINER ID   IMAGE                  COMMAND                   CREATED        STATUS        PORTS                               NAMES
b5ffd30a6969   api-todo-spring-boot   "java -jar app.jar"       12 hours ago   Up 12 hours   0.0.0.0:5000->8080/tcp              api-local
97f60563f43a   mysql-base             "docker-entrypoint.sâ€¦"   12 hours ago   Up 12 hours   0.0.0.0:3306->3306/tcp, 33060/tcp   mysql-todo
```

4. ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ã«æ¥ç¶š
   åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã€‚

```
docker exec -it api-local /bin/bash
```

ã‚³ãƒ³ãƒ†ãƒŠæ¥ç¶šå¾Œã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèªã€‚

```
pwd
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
/app
```

```
ls -lah
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
total 40M
drwxr-xr-x 1 root root 4.0K Jan  6 16:24 .
drwxr-xr-x 1 root root 4.0K Jan  6 16:24 ..
-rw-r--r-- 1 root root  40M Jan  6 16:24 app.jar
```

top ã‚³ãƒãƒ³ãƒ‰ã§çŠ¶æ³ã‚’ç¢ºèªã€‚

```
apt update
apt install procps
top
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
top - 04:02:53 up 2 days, 21:05,  0 user,  load average: 1.87, 2.09, 2.07
Tasks:   3 total,   1 running,   2 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.1 us,  0.1 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st
MiB Mem :   7837.5 total,    187.5 free,   1504.0 used,   6354.7 buff/cache
MiB Swap:   1024.0 total,   1024.0 free,      0.0 used.   6333.5 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
    1 root      20   0 6706504 338380  22516 S   0.7   4.2   1:20.24 java
  605 root      20   0    4052   3276   2764 S   0.0   0.0   0:00.01 bash
  705 root      20   0    8576   4432   2384 R   0.0   0.1   0:00.00 top
```

ã‚³ãƒ³ãƒ†ãƒŠã®æƒ…å ±ã‚’è¡¨ç¤ºã€‚

```
cat /etc/*-release
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
PRETTY_NAME="Debian GNU/Linux 12 (bookworm)"
NAME="Debian GNU/Linux"
VERSION_ID="12"
VERSION="12 (bookworm)"
VERSION_CODENAME=bookworm
ID=debian
HOME_URL="https://www.debian.org/"
SUPPORT_URL="https://www.debian.org/support"
BUG_REPORT_URL="https://bugs.debian.org/"
```

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

## REST ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆæ‰‹é †

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
   REST ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã€‚

```
cd ~/todoApp_test/tmp
mkdir restclt-reactts
cd restclt-reactts/
```

2. TSX ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆï¼ˆTypeScriptï¼‰
   index.tsx ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```
mkdir -p src
vim src/index.tsx
```

```typescript:src/index.tsx
import './styles.scss';

import React, { useState, useEffect, useRef } from 'react';
import ReactDOM from "react-dom/client"; // 'react-dom/client'ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

// ToDo ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹
interface Todo {
    id: string;
    content: string;
    created_date: string | null;
    completed_date: string | null;
    editing: boolean;
    editContent: string;
}

// ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
function App() {
    const _apiUrl: string | undefined  = process.env.API_URL; // API ã® URL
    const [_todos, setTodos]: [Todo[], React.Dispatch<React.SetStateAction<Todo[]>>] = useState<Todo[]>([]); // ToDo ã®ä¸€è¦§ã‚’ç®¡ç†ã™ã‚‹ã‚¹ãƒ†ãƒ¼ãƒˆå¤‰æ•°
    const _inputAdd: React.MutableRefObject<HTMLInputElement | null> = useRef<HTMLInputElement | null>(null); // æ–°è¦è¿½åŠ ã® input è¦ç´ ã®å‚ç…§

    // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸã¨ãã«å®Ÿè¡Œã•ã‚Œã‚‹å‰¯ä½œç”¨ãƒ•ãƒƒã‚¯
    useEffect(() => {
        fetchAndRender(); // ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨è¡¨ç¤º
    }, []);

    // ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨è¡¨ç¤º
    const fetchAndRender = async (): Promise<void> => {
        try {
            const response: Response = await fetch(`${_apiUrl}/todos`);
            if (!response.ok) { alert(`Fetch failed with status: ${response.status}`); return; }
            const data: Array<Todo> = await response.json();
            const filtered: Array<Todo> = data.filter((elem: Todo) => elem.completed_date === null);
            const updated: Array<Todo> = filtered.map((elem: Todo) => ({ // ToDo ãƒ‡ãƒ¼ã‚¿ã«ç·¨é›†é–¢é€£ã®æƒ…å ±ã‚’è¿½åŠ ã—ã¦æ–°ã—ã„é…åˆ—ã‚’ä½œæˆ
                ...elem, // å…¨ã¦ã®è¦ç´ ã‚’å¼•ç¶™ã
                editing: false, // ç·¨é›†ãƒ•ãƒ©ã‚°ã¯ OFF
                editContent: elem.content, // å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼
            }));
            setTodos(updated); // æ–°ã—ã„é…åˆ—ã‚’ã‚»ãƒƒãƒˆã—ã¦ ToDo ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
        } catch (error) { alert(`Error fetching todos: ${error}`); }
    };

    // æ–°è¦è¿½åŠ ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    const handleButtonAddClick = async (): Promise<void> => {
        try {
            if (_inputAdd.current === null) { return; }
            const content: string = _inputAdd.current.value.trim();
            if (content === "") { return; }
            if (confirm("ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ–°è¦è¿½åŠ ã—ã¾ã™ã‹?")) {
                const response: Response = await fetch(`${_apiUrl}/todos`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ content: content })
                });
                if (!response.ok) { alert(`Fetch failed with status: ${response.status}`); }
                fetchAndRender();
                _inputAdd.current.value = "";
            }
        } catch (error) { alert(`Error adding todos: ${error}`); }
    };

    // å®Œäº†ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    const handleButtonCompleteClick = (todo: Todo) => async (): Promise<void> => {
        try {
            if (confirm("ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å®Œäº†ã«ã—ã¾ã™ã‹?")) {
                const response: Response = await fetch(`${_apiUrl}/todos/${todo.id}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        content: todo.content,
                        completed_date: new Date().toISOString()
                    })
                });
                if (!response.ok) { alert(`Update failed with status: ${response.status}`); }
                fetchAndRender();
            }
        } catch (error) { alert(`Error updating todos: ${error}`); }
    };

    // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    const handleContentClick = (todo: Todo) => (): void => {
        setTodos((state: Todo[]) => state.map((elem: Todo) =>
            ({ ...elem, editing: false }) // ã™ã¹ã¦ç·¨é›†ãƒ•ãƒ©ã‚°ã¯ OFF
        ));
        setTodos((state: Todo[]) => state.map((elem: Todo) =>
            elem.id === todo.id
                ? { ...elem, editing: true } // id ãŒä¸€è‡´ã—ãŸã‚‰ç·¨é›†ãƒ•ãƒ©ã‚°ã¯ ON
                : elem // ä¸€è‡´ã—ãªã‘ã‚Œã°ãã®ã¾ã¾
        ));
    };

    // ãƒ†ãƒ¼ãƒ–ãƒ«è¡Œãƒ†ã‚­ã‚¹ãƒˆã®ãƒã‚§ãƒ³ã‚¸ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    const handleRowContentChange = (todo: Todo, value: string) => {
        setTodos((state: Todo[]) => state.map((elem: Todo) =>
            elem.id === todo.id
                ? { ...elem, editContent: value } // id ãŒä¸€è‡´ã—ãŸã‚‰ç·¨é›†ãƒ†ã‚­ã‚¹ãƒˆã«é©ç”¨
                : elem // ä¸€è‡´ã—ãªã‘ã‚Œã°ãã®ã¾ã¾
        ));
    };

    // æ›´æ–°ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    const handleButtonUpdateClick = (todo: Todo) => async (): Promise<void>  => {
        try {
            const updatedContent: string = todo.editContent.trim();
            if (updatedContent === "") { return; }
            if (confirm("ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°ã—ã¾ã™ã‹?")) {
                const response: Response = await fetch(`${_apiUrl}/todos/${todo.id}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ content: updatedContent })
                });
                if (!response.ok) { alert(`Fetch failed with status: ${response.status}`); }
                fetchAndRender();
            }
        } catch (error) { alert(`Error updating todos: ${error}`); }
    };

    // å‰Šé™¤ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
    const handleButtonDeleteClick = (todo: Todo) => async (): Promise<void> => {
        try {
            if (confirm("ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤ã—ã¾ã™ã‹?")) {
                const response: Response = await fetch(`${_apiUrl}/todos/${todo.id}`, {
                    method: "DELETE",
                });
                if (!response.ok) { alert(`Delete failed with status: ${response.status}`); }
                fetchAndRender();
            }
        } catch (error) { alert(`Error deleting todos: ${error}`); }
    };

    // JSX ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°éƒ¨åˆ†
    return (
        <div className="div-container">
            <h1>ToDo ãƒªã‚¹ãƒˆ</h1>
            <div className="div-add">
                <input
                    type="text" placeholder="æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ "
                    ref={_inputAdd}
                    onClick={handleContentClick({ id: '_dummy', content: '', created_date: null, completed_date: null, editing: false, editContent: '' })}
                />
                <button id="button-add" onClick={handleButtonAddClick}>
                    æ–°è¦è¿½åŠ 
                </button>
            </div>
            <div className="div-table" id="div-todo-list">
                {_todos.map((todo) => (
                    <div key={todo.id} className="div-row">
                        <div className="div-content">
                            {/* ç·¨é›†ä¸­ã®å ´åˆã¯ input ã‚’è¡¨ç¤ºã€ãã†ã§ãªã‘ã‚Œã° div ã‚’è¡¨ç¤º */}
                            {todo.editing ? (
                                <input
                                    type="text"
                                    className="input-edit"
                                    value={todo.editContent}
                                    onChange={(e) => handleRowContentChange(todo, e.target.value)}
                                />
                            ) : (
                                <div onClick={handleContentClick(todo)}>
                                    {todo.content}
                                </div>
                            )}
                        </div>
                        <div className="div-buttons">
                            <button
                                className="button-complete"
                                onClick={handleButtonCompleteClick(todo)}
                            >
                                å®Œäº†
                            </button>
                            <button
                                className="button-update"
                                onClick={handleButtonUpdateClick(todo)}
                                disabled={!todo.editing}
                            >
                                æ›´æ–°
                            </button>
                            <button
                                className="button-delete"
                                onClick={handleButtonDeleteClick(todo)}
                            >
                                å‰Šé™¤
                            </button>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
}

// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
const root = ReactDOM.createRoot(document.getElementById("app")!); // createRootã‚’ä½¿ã†
root.render(<App />);
```

3. HTML ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
   index.html ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```
vim src/index.html
```

```html:src/index.html
<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ToDo ã‚¢ãƒ—ãƒª</title>
    </head>
    <body>
        <div id="app"></div>
    </body>
</html>
```

5. SCSS ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
   styles.scss ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã€‚

```
vim src/styles.scss
```

```scss:src/styles.scss
$primary-font: Arial, sans-serif;

/* ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ */
$blue: royalblue;
$green: mediumseagreen;
$yellow: lightyellow;
$red: indianred;
$gray: gray;

body {
    font-family: $primary-font;
    margin: 0;
    padding: 0;
}

h1 {
    text-align: center;
    margin: 20px 0;
}

/* ã‚³ãƒ³ãƒ†ãƒŠ */
.div-container {
    max-width: 800px;
    margin: 0 auto;
}

/* ãƒ†ãƒ¼ãƒ–ãƒ« */
.div-table {
    display: table;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    border-collapse: collapse;
    border: 1px solid #ddd;
}

/* ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡Œ */
.div-row {
    display: table-row;
}

/* è¡Œã®ãƒ†ã‚­ã‚¹ãƒˆã‚»ãƒ« */
.div-content {
    display: table-cell;
    padding: 10px;
    border-top: 1px solid #ddd;
    flex: 1;
    text-align: left;
    width: 68%;
}

/* ãƒœã‚¿ãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã‚»ãƒ« */
.div-buttons {
    display: table-cell;
    padding: 10px;
    border-top: 1px solid #ddd;
    text-align: right;
}

/* å®Œäº†ãƒœã‚¿ãƒ³ */
.button-complete {
    margin-left: 10px;
    padding: 8px 12px;
    background-color: $blue;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    @media (max-width: 768px) {
        margin-left: 2px;
        padding: 5px 2px;
    }
}

/* æ›´æ–°ãƒœã‚¿ãƒ³ */
.button-update {
    margin-left: 10px;
    padding: 8px 12px;
    background-color: $green;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    &:disabled {
        background-color: $gray;
        cursor: not-allowed;
    }
    @media (max-width: 768px) {
        margin-left: 2px;
        padding: 5px 2px;
    }
}

/* æ›´æ–°ãƒ†ã‚­ã‚¹ãƒˆ */
.input-edit {
    padding: 8px;
    background-color: $yellow;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
    width: 100%;
}

/* å‰Šé™¤ãƒœã‚¿ãƒ³ */
.button-delete {
    margin-left: 10px;
    padding: 8px 12px;
    background-color: $red;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    @media (max-width: 768px) {
        margin-left: 2px;
        padding: 5px 2px;
    }
}

/* æ–°è¦è¿½åŠ ã‚¨ãƒªã‚¢ */
.div-add {
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    width: 100%;
}

/* æ–°è¦è¿½åŠ ãƒ†ã‚­ã‚¹ãƒˆ */
.div-add input {
    flex: 1;
    padding: 8px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
    &:focus {
        background-color: $yellow;
    }
}

/* æ–°è¦è¿½åŠ ãƒœã‚¿ãƒ³ */
.div-add button {
    margin-left: 10px;
    padding: 8px 12px;
    background-color: $blue;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}
```

## ãƒ“ãƒ«ãƒ‰

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

1. webpack ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```
vim webpack.config.ts
```

```ts:webpack.config.ts
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const webpack = require('webpack');

module.exports = {
  mode: 'production',
  entry: './src/index.tsx',
  output: {
    path: path.resolve(__dirname, 'build'),
    filename: 'bundle.js',
  },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        exclude: /node_modules/,
        use: 'ts-loader'
      },
      {
        test: /\.scss$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      }
    ]
  },
  resolve: {
    extensions: ['.ts', '.tsx', '.js']
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html'
    }),
    new webpack.DefinePlugin({
      'process.env.API_URL': JSON.stringify(process.env.API_URL)
    })
  ]
};
```

2. package.json ã®ä½œæˆ
   ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–ã‚’è¡Œã†ã€‚

```
npm init -y
```

ä¸Šè¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€src ãƒ•ã‚©ãƒ«ãƒ€ã¨åŒã˜éšå±¤ã« package.json ãŒç”Ÿæˆã•ã‚Œã‚‹ã€‚
package.json ã‚’ä¿®æ­£ã™ã‚‹ã€‚

```
vim package.json
```

```json:package.json
{
  "name": "restclt-reactts",
  "version": "1.0.0",
  "description": "",
  "main": "webpack.config.ts",
  "scripts": {
    "build": "webpack --mode production"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}
```

3. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```
npm install react react-dom @types/react @types/react-dom webpack webpack-cli html-webpack-plugin css-loader style-loader node-sass sass-loader typescript ts-node ts-loader --save-dev
```

ä¸Šè¨˜ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€src ãƒ•ã‚©ãƒ«ãƒ€ã¨åŒã˜éšå±¤ã«ã€node_modules ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ package-lock.json ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒä½œæˆã•ã‚Œã‚‹ã€‚

4. TypeScript ã®ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹

```
vim tsconfig.json
```

```json:tsconfig.json
{
  "compilerOptions": {
    "target": "ES2023",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "strict": true,
    "noImplicitAny": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "allowSyntheticDefaultImports": true,
    "jsx": "react"
  },
  "include": [
    "src/**/*.ts",
    "src/**/*.tsx"
  ],
  "exclude": [
    "node_modules"
  ]
}
```

### ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ

1. ç’°å¢ƒå¤‰æ•°ã‚’ä½œæˆã™ã‚‹

```
export API_URL=http://localhost:5000
```

:::message
REST API ã‚µãƒ¼ãƒ“ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã® URL ã‚’è¨­å®šã—ã¦ã„ã‚‹ã€‚
ã“ã‚Œã¯ä¸€æ™‚çš„ãªç’°å¢ƒå¤‰æ•°ã®ãŸã‚æ³¨æ„ã€‚
:::

2. ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹

```
npm run build
```

3. ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹
   â€»ã‚¢ãƒ—ãƒªã‚’åœæ­¢ã™ã‚‹æ™‚ã¯ ctrl + C ã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚

```
python3 -m http.server 8000 --directory ./build
```

Web ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã™ã‚‹ï¼ˆâ€»macOSï¼‰

```
open -a "Google Chrome" http://localhost:8000
```

:::message
ã“ã“ã¾ã§ã®æ‰‹é †ã§ã€ã‚¢ãƒ—ãƒªã‚’ Web ã‚µãƒ¼ãƒãƒ¼ä¸Šã§èµ·å‹•ã™ã‚‹ã“ã¨ãŒã§ããŸã€‚
:::

## ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•

1. ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä½œæˆ
   Nginx ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã€‚

```
vim nginx.conf
```

```linux:nginx.conf
user nginx;
worker_processes 3; # ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹æ•°ã‚’ 3 ã«è¨­å®šï¼šèª¿æ•´ã—ã¦ãã ã•ã„ã€‚
events {
    worker_connections 256; # åŒæ™‚æ¥ç¶šæ•°ã®æœ€å¤§å€¤ã‚’è¨­å®šï¼šèª¿æ•´ã—ã¦ãã ã•ã„ã€‚
}
http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    server {
        listen 80;
        server_name localhost;
        location / {
            root /usr/share/nginx/html;  # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
            index index.html;  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«
        }
    }
}
```

Docker ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã€‚

```
vim Dockerfile
```

```linux:Dockerfile
# build the app.
FROM node:lts-bookworm-slim as build-env

# Pythonã¨ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
RUN apt-get update && apt-get install -y python3 make g++

# set the working dir.
WORKDIR /app

# copy json files to the working dir.
COPY package.json package-lock.json tsconfig.json /app/
COPY webpack.config.ts /app/

# copy the source files to the working dir.
COPY src /app/src

# set the environment.
ARG API_URL
ENV API_URL=$API_URL

# run the build command to build the app.
RUN npm install
RUN npm run build

# set up the production container.
FROM nginx:bookworm

# copy nginx.conf.
COPY nginx.conf /etc/nginx/nginx.conf

# copy the build output from the build-env.
COPY --from=build-env /app/build /usr/share/nginx/html

# expose port.
EXPOSE 80

# command to run nginx.
CMD ["nginx","-g","daemon off;"]
```

2. ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
   Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’èµ·å‹•ã€‚
   :::message
   â€»Docker ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚’èµ·å‹•æ¸ˆã¿ã®å ´åˆã¯ä¸è¦
   :::

```
sudo service docker start
```

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚

```
docker build --no-cache --build-arg API_URL=http://localhost:5000 --tag app-todo-reactts:latest .
```

:::message alert
ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ“ãƒ«ãƒ‰å‰ã«ã€REST API ã‚µãƒ¼ãƒ“ã‚¹ã® URL ãŒç¢ºå®šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
:::

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç¢ºèª

```
docker images | grep app-todo-reactts
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
app-todo-reactts       latest    8b398433ef7d   41 seconds ago   280MB
```

ã“ã“ã¾ã§ã®æ‰‹é †ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã® Docker ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã®ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ããŸã€‚

3. ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
   ãƒ­ãƒ¼ã‚«ãƒ«ã§ REST ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã€‚ï¼ˆâ€»ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢ãŒ ctrl+C ã‚’æŠ¼ä¸‹ï¼‰
   :::message alert
   ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã‚’ã™ã‚‹ãŸã‚ã« net-todo ã¨ã„ã† Docker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ã‚ã‚‰ã‹ã˜ã‚ä½œæˆã—ã¦ã‚ã‚‹ã®ã§æ³¨æ„ã€‚
   :::

```
docker run --rm --publish 8000:80 --name app-local --net net-todo app-todo-reactts
```

ã“ã“ã¾ã§ã®æ‰‹é †ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã® Docker ã§ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã®ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã§ããŸã€‚

5. ã‚³ãƒ³ãƒ†ãƒŠã®å‹•ä½œç¢ºèª
   Web ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªã™ã‚‹ï¼ˆâ€»macOSï¼‰

```
open -a "Google Chrome" http://localhost:8000
```

![](https://storage.googleapis.com/zenn-user-upload/9dc76ced52d3-20250107.png)

ã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã€‚

```
docker ps
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
CONTAINER ID   IMAGE                  COMMAND                   CREATED         STATUS         PORTS                               NAMES
e69f2243697a   app-todo-reactts       "/docker-entrypoint.â€¦"   2 minutes ago   Up 2 minutes   0.0.0.0:8000->80/tcp                app-local
4a0cdd615261   api-todo-spring-boot   "java -jar app.jar"       8 hours ago     Up 8 hours     0.0.0.0:5000->8080/tcp              api-local
97f60563f43a   mysql-base             "docker-entrypoint.sâ€¦"   21 hours ago    Up 21 hours    0.0.0.0:3306->3306/tcp, 33060/tcp   mysql-todo
```

:::message
ã“ã“ã¾ã§ã®æ‰‹é †ã§ã€ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦èµ·å‹•ã—ãŸ ToDo ã‚¢ãƒ—ãƒªã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒã§ããŸã€‚
:::

6. ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶š
   åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã€‚

```
docker exec -it app-local /bin/bash
```

ã‚³ãƒ³ãƒ†ãƒŠæ¥ç¶šå¾Œã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèªã€‚ï¼ˆâ€»ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã‚‹æ™‚ã¯ ctrl+Dï¼‰

```
pwd
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
/
```

```
cd /usr/share/nginx/html
ls -lah
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
total 208K
drwxr-xr-x 1 root root 4.0K Jan  7 12:35 .
drwxr-xr-x 1 root root 4.0K Dec 24 23:02 ..
-rw-r--r-- 1 root root  497 Nov 26 15:55 50x.html
-rw-r--r-- 1 root root 186K Jan  7 12:35 bundle.js
-rw-r--r-- 1 root root  962 Jan  7 12:35 bundle.js.LICENSE.txt
-rw-r--r-- 1 root root  239 Jan  7 12:35 index.html
```

top ã‚³ãƒãƒ³ãƒ‰ã§çŠ¶æ³ã‚’ç¢ºèªã€‚

```
apt update
apt install procps
top
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
top - 12:54:09 up 3 days,  5:27,  0 user,  load average: 2.19, 2.26, 2.18
Tasks:   6 total,   1 running,   5 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.0 us,  0.1 sy,  0.0 ni, 99.8 id,  0.0 wa,  0.0 hi,  0.1 si,  0.0 st
MiB Mem :   7837.5 total,    800.1 free,   1534.4 used,   5711.9 buff/cache
MiB Swap:   1024.0 total,   1024.0 free,      0.0 used.   6303.1 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
    1 root      20   0   11160   7200   6048 S   0.0   0.1   0:00.01 nginx
   29 nginx     20   0   11332   2732   1540 S   0.0   0.0   0:00.00 nginx
   30 nginx     20   0   11332   2732   1540 S   0.0   0.0   0:00.00 nginx
   31 nginx     20   0   11332   2600   1408 S   0.0   0.0   0:00.00 nginx
   38 root      20   0    4052   3276   2764 S   0.0   0.0   0:00.01 bash
  228 root      20   0    8748   4376   2328 R   0.0   0.1   0:00.00 top
```

ã‚³ãƒ³ãƒ†ãƒŠã®æƒ…å ±ã‚’è¡¨ç¤ºã€‚

```
cat /etc/*-release
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹

```
PRETTY_NAME="Debian GNU/Linux 12 (bookworm)"
NAME="Debian GNU/Linux"
VERSION_ID="12"
VERSION="12 (bookworm)"
VERSION_CODENAME=bookworm
ID=debian
HOME_URL="https://www.debian.org/"
SUPPORT_URL="https://www.debian.org/support"
BUG_REPORT_URL="https://bugs.debian.org/"
```

# ã¾ã¨ã‚

- ä»Šå›å­¦ã³ãŸã‹ã£ãŸå†…å®¹ã«ã¤ã„ã¦
  ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒˆãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ä¸‹ã®éšå±¤ã«ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€REST API ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSSï¼‰ã€REST ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆFEï¼‰ã®ãã‚Œãã‚Œã®ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€å„ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç›´ä¸‹ã« Dockerfile ã‚’ä½œæˆã—ãŸã€‚
  å„ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã”ã¨ã«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ç”»é¢ã‚’å¤‰ãˆã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã§ã€ãã‚Œãã‚Œã®ã‚¢ãƒ—ãƒªã‚’ Docker ã‚³ãƒ³ãƒ†ãƒŠã¨ã—ã¦èµ·å‹•ã—ãŸã€‚
  ã•ã‚‰ã«ã€Docker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆä»Šå›ã¯ net-todoï¼‰ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ†ãƒŠé–“é€šä¿¡ã‚’å®Ÿç¾ã§ããŸã€‚

- ä»Šå¾Œã«å‘ã‘ã¦

1. ã‚¢ãƒ—ãƒªã®æœ¬ç•ªç’°å¢ƒã§ã®èµ·å‹•ã«é–¢ã—ã¦
   Docker ã‚³ãƒ³ãƒ†ãƒŠã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€è‡ªèº«ã®é–‹ç™ºç’°å¢ƒã§è¤‡æ•°ã®ã‚¢ãƒ—ãƒªï¼ˆä»Šå›ã ã¨ Spring BootÃ—Reactï¼‰ã‚’èµ·å‹•ã—ã¦é€šä¿¡é€£æºã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸãŒã€å®Ÿéš›ã«è‡ªèº«ãŒä¸–ã®ä¸­ã« Web ã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹å ´åˆã¯ã©ã®ã‚ˆã†ã«ã—ã¦ã‚‹ã®ã‹ãªã©ã¯è‡ªåˆ†ã¯ã‚ã‹ã£ã¦ã„ãªã„ã®ã§ã€ä»Šå¾Œå­¦ç¿’ã—ã¦ã„ããŸã„ã€‚
2. Docker ã®åŸºæœ¬ã‚„ä½¿ã„æ–¹ã‚’å­¦ã‚“ã ãŒã€Kubernetes ã®ç›®çš„ã‚„ä½¿ã„æ–¹ã‚‚æ°—ã«ãªã£ã¦ã„ã‚‹ã€‚
3. ä»Šå›ã¯ Spring BootÃ—React(TypeScript)ã§ Web ã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã™ã‚‹è¦‹æœ¬ã‚’ãªãã‚‹ã‚ˆã†ã«é€²ã‚ãŸãŒã€ã‚‚ã†å°‘ã—ãã‚Œã‚‰ã‚’ä½¿ã£ãŸé–‹ç™ºã«æ…£ã‚ŒãŸã„ã®ã§ã€åˆ¥é€”ã¾ãŸè‡ªåˆ†ã§ã‚‚é–‹ç™ºã‚’ã—ã¦ã¿ã‚‹ã€‚

# å‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆ

https://qiita.com/studio_meowtoon/items/7d4d0bf73e04e01be558
https://qiita.com/studio_meowtoon/items/ce1c853893388c106d22
